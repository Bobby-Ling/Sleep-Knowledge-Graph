(window["webpackJsonp"]=window["webpackJsonp"]||[]).push([["pages-diagnosis-diagnosis","components-progress-bar-progress-bar"],{"0e4f":function(t,e,a){"use strict";a.d(e,"b",(function(){return s})),a.d(e,"c",(function(){return n})),a.d(e,"a",(function(){}));var s=function(){var t=this,e=t.$createElement,a=t._self._c||e;return a("v-uni-view",{staticClass:"nav-container"},[a("v-uni-view",{staticClass:"progress-bar"},[a("v-uni-view",{staticClass:"progress-track"},[a("v-uni-view",{staticClass:"progress-fill",style:"width: "+20*t.currentStep+"%"})],1),a("v-uni-view",{staticClass:"steps-wrapper"},t._l(t.steps,(function(e,s){return a("v-uni-view",{key:s,class:"step-item "+(t.currentStep>=s?"completed":"")+" "+(t.currentStep==s?"current":""),attrs:{"data-path":e.path,"data-index":s},on:{click:function(e){arguments[0]=e=t.$handleEvent(e),t.navigateToStep.apply(void 0,arguments)}}},[a("v-uni-view",{staticClass:"step-circle"},[a("v-uni-view",{staticClass:"circle-content"},[t.currentStep>s?a("v-uni-text",{staticClass:"check-icon"},[t._v("✓")]):a("v-uni-text",[t._v(t._s(s+1))])],1)],1),a("v-uni-view",{staticClass:"step-label"},[t._v(t._s(e.name))])],1)})),1)],1),a("v-uni-view",{staticClass:"control-buttons"},[a("v-uni-button",{class:"btn prev "+(0===t.currentStep?"disabled":""),attrs:{disabled:0===t.currentStep},on:{click:function(e){arguments[0]=e=t.$handleEvent(e),t.handlePrevStep.apply(void 0,arguments)}}},[a("v-uni-text",{staticClass:"btn-icon"},[t._v("←")]),a("v-uni-text",[t._v("上一步")])],1),a("v-uni-button",{class:"btn skip "+(0===t.currentStep||3===t.currentStep?"disabled":""),attrs:{disabled:0===t.currentStep||3===t.currentStep},on:{click:function(e){arguments[0]=e=t.$handleEvent(e),t.handleSkip.apply(void 0,arguments)}}},[a("v-uni-text",{staticClass:"btn-icon"},[t._v("⤵")]),a("v-uni-text",[t._v("跳过")])],1),a("v-uni-button",{class:"btn next "+(2===t.currentStep?"disabled":""),on:{click:function(e){arguments[0]=e=t.$handleEvent(e),t.handleNextStep.apply(void 0,arguments)}}},[a("v-uni-text",[t._v("下一步")]),a("v-uni-text",{staticClass:"btn-icon"},[t._v("→")])],1)],1)],1)},n=[]},"16bb":function(t,e,a){"use strict";var s=a("3983"),n=a.n(s);n.a},"177c":function(t,e,a){"use strict";a.r(e);var s=a("2e9e"),n=a.n(s);for(var i in s)["default"].indexOf(i)<0&&function(t){a.d(e,t,(function(){return s[t]}))}(i);e["default"]=n.a},"2e50":function(t,e,a){var s=a("c86c");e=s(!1),e.push([t.i,'/* progress-bar.wxss */.nav-container[data-v-9b8021d0]{width:100%;background:#fff;padding:%?20?% %?24?%;box-sizing:border-box;box-shadow:0 %?2?% %?8?% rgba(0,0,0,.05)}.progress-bar[data-v-9b8021d0]{position:relative;padding:%?32?% 0}.progress-track[data-v-9b8021d0]{position:absolute;top:%?52?%;left:8%;width:84%;height:%?4?%;background:#e2e8f0;border-radius:%?4?%}.progress-fill[data-v-9b8021d0]{position:absolute;top:0;left:0;height:100%;background:linear-gradient(90deg,#2563eb,#3b82f6);border-radius:%?4?%;transition:width .4s cubic-bezier(.4,0,.2,1);box-shadow:0 0 %?8?% rgba(37,99,235,.3)}.steps-wrapper[data-v-9b8021d0]{position:relative;display:flex;justify-content:space-between;padding:0 %?20?%}.step-item[data-v-9b8021d0]{display:flex;flex-direction:column;align-items:center;position:relative;flex:1;z-index:1;transition:all .3s ease}.step-circle[data-v-9b8021d0]{width:%?40?%;height:%?40?%;border-radius:50%;background:#fff;border:%?2?% solid #cbd5e0;display:flex;align-items:center;justify-content:center;margin-bottom:%?12?%;transition:all .3s cubic-bezier(.4,0,.2,1);font-size:%?22?%;color:#718096;box-shadow:0 %?2?% %?4?% rgba(0,0,0,.05)}.step-label[data-v-9b8021d0]{font-size:%?22?%;color:#718096;transition:all .3s ease;text-align:center;white-space:nowrap;-webkit-transform:scale(.9);transform:scale(.9)}.step-item.completed .step-circle[data-v-9b8021d0]{background:#3b82f6;border-color:#3b82f6;color:#fff;box-shadow:0 %?2?% %?8?% rgba(59,130,246,.3)}.step-item.completed .step-label[data-v-9b8021d0]{color:#3b82f6}.step-item.current .step-circle[data-v-9b8021d0]{width:%?48?%;height:%?48?%;background:#fff;border:%?3?% solid #3b82f6;color:#3b82f6;box-shadow:0 0 0 %?6?% rgba(59,130,246,.2);-webkit-transform:scale(1.2);transform:scale(1.2);font-weight:700}.step-item.current .step-label[data-v-9b8021d0]{color:#3b82f6;-webkit-transform:scale(1);transform:scale(1);font-weight:700;font-size:%?26?%}.check-icon[data-v-9b8021d0]{font-size:%?24?%;font-weight:700}.control-buttons[data-v-9b8021d0]{display:flex;justify-content:center;gap:%?16?%;margin-top:%?32?%;padding:0 %?8?%}.btn[data-v-9b8021d0]{height:%?76?%;padding:0 %?36?%;font-size:%?28?%;border-radius:%?38?%;display:flex;align-items:center;justify-content:center;gap:%?8?%;position:relative;overflow:hidden;transition:all .2s ease}.btn[data-v-9b8021d0]::after{content:"";position:absolute;left:50%;top:50%;width:100%;height:100%;background:radial-gradient(circle,hsla(0,0%,100%,.3) 0,transparent 60%);-webkit-transform:translate(-50%,-50%) scale(0);transform:translate(-50%,-50%) scale(0);opacity:0;transition:opacity .3s ease-out,-webkit-transform .5s ease-out;transition:transform .5s ease-out,opacity .3s ease-out;transition:transform .5s ease-out,opacity .3s ease-out,-webkit-transform .5s ease-out}.btn[data-v-9b8021d0]:active::after{-webkit-transform:translate(-50%,-50%) scale(2);transform:translate(-50%,-50%) scale(2);opacity:1}.btn-icon[data-v-9b8021d0]{display:inline-flex;align-items:center;justify-content:center;width:%?32?%;height:%?32?%}.prev[data-v-9b8021d0],\n.skip[data-v-9b8021d0]{min-width:%?160?%;background:#f8fafc;border:%?1?% solid #e2e8f0;color:#475569}.prev[data-v-9b8021d0]:active,\n.skip[data-v-9b8021d0]:active{background:#e5e7eb;-webkit-transform:scale(.98);transform:scale(.98)}.next[data-v-9b8021d0]{background:linear-gradient(135deg,#2563eb,#3b82f6);min-width:%?200?%;color:#fff;font-weight:500;border:none;box-shadow:0 %?4?% %?12?% rgba(37,99,235,.2)}.next[data-v-9b8021d0]:active{-webkit-transform:scale(.98);transform:scale(.98);box-shadow:0 %?1?% %?2?% rgba(37,99,235,.2)}.btn.disabled[data-v-9b8021d0]{opacity:.5;cursor:not-allowed;pointer-events:none;box-shadow:none}\n/* 暗色模式适配 */@media (prefers-color-scheme:dark){.nav-container[data-v-9b8021d0]{background:#1a202c}.progress-track[data-v-9b8021d0]{background:#2d3748}.step-circle[data-v-9b8021d0]{background:#2d3748;border-color:#4a5568}.step-label[data-v-9b8021d0]{color:#a0aec0}.prev[data-v-9b8021d0],\n    .skip[data-v-9b8021d0]{background:#2d3748;color:#e2e8f0;border-color:#4a5568}.prev[data-v-9b8021d0]:active,\n    .skip[data-v-9b8021d0]:active{background:#374151}.next[data-v-9b8021d0]{background:linear-gradient(135deg,#1d4ed8,#2563eb)}.btn.disabled[data-v-9b8021d0]{background:#1f2937;color:#6b7280}.step-item.current .step-circle[data-v-9b8021d0]{background:#2d3748}}\n/* 响应式调整 */@media screen and (max-width:375px){.nav-container[data-v-9b8021d0]{padding:%?16?% %?20?%}.btn[data-v-9b8021d0]{height:%?70?%;font-size:%?26?%;padding:0 %?32?%}.step-label[data-v-9b8021d0]{font-size:%?20?%}}',""]),t.exports=e},"2e9e":function(t,e,a){"use strict";a("6a54"),Object.defineProperty(e,"__esModule",{value:!0}),e.default=void 0,a("64aa");var s={data:function(){return{steps:[{id:0,name:"症状选择",path:"/pages/chooseSymptoms/chooseSymptoms"},{id:1,name:"初步诊断",path:"/pages/diagnosisResult/diagnosisResult"},{id:2,name:"问卷调查",path:"/pages/test-questions/test-questions"},{id:3,name:"问卷分析",path:"/pages/diagnosis/diagnosis"},{id:4,name:"病历上传",path:"/pages/upload/upload"},{id:5,name:"最终诊断",path:"/pages/analysis_all/analysis_all"}]}},props:{currentStep:{type:Number,default:0}},methods:{handlePrevStep:function(){var t=this.currentStep,e=getApp();switch(t){case 1:uni.navigateTo({url:"/pages/chooseSymptoms/chooseSymptoms"});break;case 2:0===e.globalData.indexNext?uni.navigateTo({url:"/pages/diagnosisResult/diagnosisResult"}):uni.navigateTo({url:"/pages/diagnosis/diagnosis"});break;case 3:e.globalData.indexNext-=1,uni.navigateTo({url:"/pages/test-questions/test-questions?id=".concat(e.globalData.relatedScalesIndex[e.globalData.indexNext])});break;case 4:uni.navigateTo({url:"/pages/diagnosis/diagnosis"});break}},handleNextStep:function(){var t=this.currentStep,e=getApp();switch(t){case 0:if(0===e.globalData.symptoms.length)return void uni.showToast({title:"请至少选择一个症状",icon:"none",duration:2e3});uni.navigateTo({url:"/pages/diagnosisResult/diagnosisResult"});break;case 1:e.globalData.indexNext<e.globalData.relatedScalesIndex.length?uni.navigateTo({url:"/pages/test-questions/test-questions?id=".concat(e.globalData.relatedScalesIndex[e.globalData.indexNext])}):uni.navigateTo({url:"/pages/upload/upload"});break;case 3:console.log(e.globalData.indexNext),console.log(e.globalData.relatedScalesIndex),e.globalData.indexNext<e.globalData.relatedScalesIndex.length?uni.navigateTo({url:"/pages/test-questions/test-questions?id=".concat(e.globalData.relatedScalesIndex[e.globalData.indexNext])}):uni.navigateTo({url:"/pages/upload/upload"});break;case 4:uni.navigateTo({url:"/pages/analysis_all/analysis_all"});break}},handleSkip:function(){var t=this.currentStep,e=getApp();switch(t){case 1:uni.navigateTo({url:"/pages/upload/upload"});break;case 2:e.globalData.indexNext<e.globalData.relatedScalesIndex.length-1?(e.globalData.indexNext+=1,uni.navigateTo({url:"/pages/test-questions/test-questions?id=".concat(e.globalData.relatedScalesIndex[e.globalData.indexNext])})):uni.navigateTo({url:"/pages/upload/upload"});break;case 4:uni.navigateTo({url:"/pages/analysis_all/analysis_all"});break}},navigateToStep:function(){console.log("占位：函数 navigateToStep 未声明")}},created:function(){}};e.default=s},3983:function(t,e,a){var s=a("2e50");s.__esModule&&(s=s.default),"string"===typeof s&&(s=[[t.i,s,""]]),s.locals&&(t.exports=s.locals);var n=a("967d").default;n("86ee0858",s,!0,{sourceMap:!1,shadowMode:!1})},"497c":function(t,e,a){"use strict";a.d(e,"b",(function(){return n})),a.d(e,"c",(function(){return i})),a.d(e,"a",(function(){return s}));var s={progressBar:a("7b50").default},n=function(){var t=this,e=t.$createElement,a=t._self._c||e;return a("v-uni-view",[a("progress-bar",{attrs:{"current-step":t.currentStep}}),a("v-uni-view",{staticClass:"container"},[t.loading?a("v-uni-view",{staticClass:"loading"},[a("v-uni-view",{staticClass:"loading-spinner"}),a("v-uni-text",[t._v("分析中...")])],1):t.error?a("v-uni-view",{staticClass:"error"},[a("v-uni-icon",{attrs:{type:"warn",size:"64"}}),a("v-uni-text",[t._v("分析失败，请重试")])],1):[a("v-uni-view",{staticClass:"analysis-card current-analysis"},[a("v-uni-view",{staticClass:"card-title"},[t._v("当前问卷分析")]),t.currentAnalysis.summary?a("v-uni-view",{staticClass:"score-section"},[a("v-uni-view",{staticClass:"progress-container"},[a("v-uni-canvas",{staticClass:"progress-canvas",attrs:{"canvas-id":"progressBar"}}),a("v-uni-view",{staticClass:"score-text"},[a("v-uni-text",{staticClass:"score"},[t._v(t._s(t.currentAnalysis.summary.score))]),a("v-uni-text",{staticClass:"max-score"},[t._v("/"+t._s(t.currentAnalysis.summary.max_score))])],1)],1),a("v-uni-view",{staticClass:"interpretation"},[a("v-uni-text",{staticClass:"level-label"},[t._v(t._s(t.currentAnalysis.summary.interpretation))]),a("v-uni-view",{staticClass:"levels-list"},t._l(t.currentAnalysis.summary.levels,(function(e,s){return a("v-uni-view",{key:s,staticClass:"level-item"},[a("v-uni-view",{staticClass:"level-dot"}),a("v-uni-text",[t._v(t._s(e.label)+" ("+t._s(e.from)+"-"+t._s(e.to)+"分)")])],1)})),1)],1)],1):t._e(),t.currentAnalysis.details?a("v-uni-view",{staticClass:"components-section"},[a("v-uni-view",{staticClass:"component-list"},t._l(t.currentAnalysis.details.components,(function(e,s){return a("v-uni-view",{key:s,staticClass:"component-item"},[a("v-uni-view",{staticClass:"component-header"},[a("v-uni-text",{staticClass:"component-name"},[t._v(t._s(e.name))]),a("v-uni-text",{staticClass:"component-score"},[t._v(t._s(e.score)+"/"+t._s(e.max_score))])],1),a("v-uni-view",{staticClass:"progress-bar"},[a("v-uni-view",{staticClass:"progress",style:"width: "+e.score/e.max_score*100+"%"})],1)],1)})),1)],1):t._e()],1),t.combinedAnalysis?a("v-uni-view",{staticClass:"analysis-card combined-analysis"},[a("v-uni-view",{staticClass:"card-title"},[t._v("综合诊断分析")]),a("v-uni-view",{staticClass:"summary-section"},[a("v-uni-text",{staticClass:"summary-text"},[t._v(t._s(t.combinedAnalysis.summary))])],1),a("v-uni-view",{staticClass:"predictions-section"},[a("v-uni-view",{staticClass:"prediction-list"},t._l(t.combinedAnalysis.predict,(function(e,s){return a("v-uni-view",{key:s,staticClass:"prediction-item"},[a("v-uni-view",{staticClass:"prediction-bar"},[a("v-uni-view",{staticClass:"prediction-progress",style:"width: "+100*e.probability+"%"}),a("v-uni-text",{staticClass:"prediction-label"},[t._v(t._s(e.diagnosis))]),a("v-uni-text",{staticClass:"prediction-probability"},[t._v(t._s(e.probability))])],1)],1)})),1)],1)],1):t._e()]],2)],1)},i=[]},"669a":function(t,e,a){"use strict";a("6a54");var s=a("f5bd").default;Object.defineProperty(e,"__esModule",{value:!0}),e.default=void 0,a("c223");var n=s(a("7b50")),i=s(a("7b50")),r={components:{progressBar:n.default},data:function(){return{currentAnalysis:null,combinedAnalysis:null,loading:!0,error:!1,currentStep:3,progressPercent:0,score:"",max_score:"",interpretation:"",levels:[],components:[]}},onLoad:function(){var t=getApp(),e=t.globalData.selectedAnswers,a=t.globalData.schema_name,s=t.globalData.session_id;console.log(e),this.getCurrentAnalysis(s,a,e),this.getCombinedAnalysis(s,t.globalData.scaleResults)},methods:{updateStep:function(t){this.setData({currentStep:t})},getCurrentAnalysis:function(t,e,a){var s=this;uni.request({url:"http://113.44.52.217:5000/scales/".concat(t,"/").concat(e),method:"POST",data:a,success:function(t){if(s.setData({currentAnalysis:t.data,loading:!1}),t.data.summary){var e=t.data.summary.score,a=t.data.summary.max_score,n=e/a*100;s.drawProgressBar(n)}},fail:function(t){console.error("Failed to get current analysis:",t),s.setData({error:!0,loading:!1})}})},getCombinedAnalysis:function(t,e){var a=this;uni.request({url:"http://113.44.52.217:5000/scales/".concat(t),method:"POST",data:e,success:function(t){a.setData({combinedAnalysis:t.data})},fail:function(t){console.error("Failed to get combined analysis:",t)}})},drawProgressBar:function(t){var e=uni.createCanvasContext("progressBar");e.beginPath(),e.arc(75,75,60,0,2*Math.PI),e.setLineWidth(10),e.setStrokeStyle("#E5E5E5"),e.stroke(),e.beginPath(),e.arc(75,75,60,-Math.PI/2,-Math.PI/2+2*Math.PI*t/100),e.setLineWidth(10),e.setStrokeStyle(this.getColorByPercentage(t)),e.stroke(),e.draw()},getColorByPercentage:function(t){return t<=30?"#4CAF50":t<=70?"#FFC107":"#F44336"}}};e.default=r,e.default.components=Object.assign({"progress-bar":i.default},e.default.components||{})},"6b2c":function(t,e,a){var s=a("c86c");e=s(!1),e.push([t.i,"/* diagnosis.wxss */.container[data-v-499e48e4]{padding:%?20?%;background:#f5f6fa;min-height:100vh}.loading[data-v-499e48e4]{flex-direction:column;align-items:center;justify-content:center;height:%?400?%}.loading-spinner[data-v-499e48e4]{width:%?64?%;height:%?64?%;border:%?6?% solid #f3f3f3;border-top:%?6?% solid #007aff;border-radius:50%;-webkit-animation:spin-data-v-499e48e4 1s linear infinite;animation:spin-data-v-499e48e4 1s linear infinite}@-webkit-keyframes spin-data-v-499e48e4{0%{-webkit-transform:rotate(0deg);transform:rotate(0deg)}100%{-webkit-transform:rotate(1turn);transform:rotate(1turn)}}@keyframes spin-data-v-499e48e4{0%{-webkit-transform:rotate(0deg);transform:rotate(0deg)}100%{-webkit-transform:rotate(1turn);transform:rotate(1turn)}}.error[data-v-499e48e4]{display:flex;flex-direction:column;align-items:center;justify-content:center;height:%?400?%;color:#ff4d4f}.analysis-card[data-v-499e48e4]{background:#fff;border-radius:%?20?%;padding:%?30?%;margin-bottom:%?30?%;box-shadow:0 %?2?% %?10?% rgba(0,0,0,.05)}.card-title[data-v-499e48e4]{font-size:%?36?%;font-weight:700;color:#333;margin-bottom:%?30?%;padding-left:%?20?%;border-left:%?8?% solid #007aff}.score-section[data-v-499e48e4]{display:flex;align-items:center;justify-content:space-between;margin-bottom:%?40?%}.progress-container[data-v-499e48e4]{position:relative;width:%?150?%}.score-text[data-v-499e48e4]{position:absolute;top:50%;left:100%;-webkit-transform:translate(-50%,-50%);transform:translate(-50%,-50%);text-align:center}.score[data-v-499e48e4]{font-size:%?40?%;font-weight:700;color:#333}.max-score[data-v-499e48e4]{font-size:%?24?%;color:#999}.interpretation[data-v-499e48e4]{margin-left:%?100?%}.level-label[data-v-499e48e4]{font-size:%?32?%;font-weight:700;color:#333;margin-bottom:%?20?%;display:block}.levels-list[data-v-499e48e4]{margin-top:%?20?%}.level-item[data-v-499e48e4]{display:flex;align-items:center;margin-bottom:%?10?%;font-size:%?26?%;color:#666}.level-dot[data-v-499e48e4]{width:%?12?%;height:%?12?%;border-radius:50%;background:#007aff;margin-right:%?10?%}.components-section[data-v-499e48e4]{margin-top:%?40?%}.component-item[data-v-499e48e4]{margin-bottom:%?30?%}.component-header[data-v-499e48e4]{display:flex;justify-content:space-between;margin-bottom:%?10?%}.component-name[data-v-499e48e4]{font-size:%?28?%;color:#333}.component-score[data-v-499e48e4]{font-size:%?28?%;color:#666}.progress-bar[data-v-499e48e4]{height:%?12?%;background:#f5f5f5;border-radius:%?6?%;overflow:hidden}.progress[data-v-499e48e4]{height:100%;background:#007aff;border-radius:%?6?%;transition:width .3s ease}.summary-section[data-v-499e48e4]{margin-bottom:%?40?%}.summary-text[data-v-499e48e4]{font-size:%?32?%;color:#333;line-height:1.6}.prediction-item[data-v-499e48e4]{margin-bottom:%?30?%}.prediction-bar[data-v-499e48e4]{position:relative;height:%?80?%;background:#f5f5f5;border-radius:%?10?%;overflow:hidden}.prediction-progress[data-v-499e48e4]{position:absolute;height:100%;background:rgba(0,122,255,.1);transition:width .3s ease}.prediction-label[data-v-499e48e4]{position:absolute;left:%?20?%;top:50%;-webkit-transform:translateY(-50%);transform:translateY(-50%);font-size:%?28?%;color:#333}.prediction-probability[data-v-499e48e4]{position:absolute;right:%?20?%;top:50%;-webkit-transform:translateY(-50%);transform:translateY(-50%);font-size:%?28?%;color:#007aff;font-weight:700}",""]),t.exports=e},"6f25":function(t,e,a){"use strict";var s=a("fda3"),n=a.n(s);n.a},"7b50":function(t,e,a){"use strict";a.r(e);var s=a("0e4f"),n=a("177c");for(var i in n)["default"].indexOf(i)<0&&function(t){a.d(e,t,(function(){return n[t]}))}(i);a("16bb");var r=a("828b"),o=Object(r["a"])(n["default"],s["b"],s["c"],!1,null,"9b8021d0",null,!1,s["a"],void 0);e["default"]=o.exports},ab82:function(t,e,a){"use strict";a.r(e);var s=a("669a"),n=a.n(s);for(var i in s)["default"].indexOf(i)<0&&function(t){a.d(e,t,(function(){return s[t]}))}(i);e["default"]=n.a},da4f:function(t,e,a){"use strict";a.r(e);var s=a("497c"),n=a("ab82");for(var i in n)["default"].indexOf(i)<0&&function(t){a.d(e,t,(function(){return n[t]}))}(i);a("6f25");var r=a("828b"),o=Object(r["a"])(n["default"],s["b"],s["c"],!1,null,"499e48e4",null,!1,s["a"],void 0);e["default"]=o.exports},fda3:function(t,e,a){var s=a("6b2c");s.__esModule&&(s=s.default),"string"===typeof s&&(s=[[t.i,s,""]]),s.locals&&(t.exports=s.locals);var n=a("967d").default;n("1de7b498",s,!0,{sourceMap:!1,shadowMode:!1})}}]);